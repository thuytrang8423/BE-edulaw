{
  "openapi": "3.0.0",
  "info": {
    "title": "AI Chatbot Law API",
    "version": "1.0.0",
    "description": "API documentation for the AI Chatbot for Education Laws."
  },
  "servers": [
    {
      "url": "https://be-edulaw-production.up.railway.app/api",
      "description": "Railway server"
    }
  ],
  "paths": {
    "/auth/register": {
      "post": {
        "summary": "Register a new user",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "email": { "type": "string", "format": "email" },
                  "password": { "type": "string", "format": "password" }
                },
                "required": ["name", "email", "password"]
              },
              "example": {
                "name": "Nguyen Van A",
                "email": "vana@example.com",
                "password": "Password123"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered successfully. Verification code sent to email."
          },
          "409": { "description": "User with this email already exists" }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Login user",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "password": { "type": "string", "format": "password" }
                },
                "required": ["email", "password"]
              },
              "example": {
                "email": "vana@example.com",
                "password": "Password123"
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Login successful. JWT tokens returned." },
          "401": { "description": "Invalid credentials" }
        }
      }
    },
    "/auth/verify-email-code": {
      "post": {
        "summary": "Verify user email with 6-digit code",
        "description": "Nhập mã code 6 số đã gửi về email để xác thực tài khoản. Không dùng link.",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "code": { "type": "string", "example": "123456" }
                },
                "required": ["email", "code"]
              },
              "example": {
                "email": "vana@example.com",
                "code": "123456"
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Email verified successfully" },
          "400": { "description": "Invalid or expired verification code" },
          "404": { "description": "User not found" }
        }
      }
    },
    "/auth/resend-verification": {
      "post": {
        "summary": "Resend verification code (6 digits)",
        "description": "Gửi lại mã xác thực 6 số về email. Không gửi link.",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "format": "email" }
                },
                "required": ["email"]
              },
              "example": {
                "email": "vana@example.com"
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Verification code sent successfully" },
          "404": { "description": "User not found" },
          "400": { "description": "Email is already verified" }
        }
      }
    },
    "/auth/forgot-password": {
      "post": {
        "summary": "Request password reset (send 6-digit code)",
        "description": "Gửi mã code 6 số về email để đặt lại mật khẩu. Không gửi link.",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "format": "email" }
                },
                "required": ["email"]
              },
              "example": {
                "email": "vana@example.com"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password reset code sent if account exists"
          },
          "500": { "description": "Failed to send password reset code" }
        }
      }
    },
    "/auth/reset-password": {
      "post": {
        "summary": "Reset password with 6-digit code",
        "description": "Đặt lại mật khẩu bằng mã code 6 số đã gửi về email",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "code": { "type": "string", "example": "123456" },
                  "password": { "type": "string", "format": "password" }
                },
                "required": ["email", "code", "password"]
              },
              "example": {
                "email": "vana@example.com",
                "code": "123456",
                "password": "NewPassword123"
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Password reset successfully" },
          "400": { "description": "Invalid or expired code" },
          "404": { "description": "User not found" }
        }
      }
    },
    "/auth/refresh-token": {
      "post": {
        "summary": "Refresh access token",
        "tags": ["Auth"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "refreshToken": { "type": "string" }
                },
                "required": ["refreshToken"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "New access and refresh tokens returned" },
          "401": { "description": "Invalid refresh token" }
        }
      }
    },

    "/auth/logout": {
      "post": {
        "summary": "Logout user (client-side token removal)",
        "tags": ["Auth"],
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Logout successful" },
          "401": { "description": "Unauthorized" }
        }
      }
    },

    "/legal-docs": {
      "get": {
        "summary": "[USER/ADMIN] Get all legal documents",
        "description": "User và admin đều có thể xem danh sách văn bản pháp luật.",
        "tags": ["LegalDocument"],
        "responses": { "200": { "description": "List of legal documents" } }
      },
      "post": {
        "summary": "[ADMIN] Create a new legal document",
        "description": "Chỉ admin mới được tạo mới văn bản pháp luật.",
        "tags": ["LegalDocument"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "document_name": { "type": "string" },
                  "document_type": { "type": "string" },
                  "document_date_issue": { "type": "string", "format": "date" },
                  "document_signee": { "type": "string" }
                },
                "required": [
                  "document_name",
                  "document_type",
                  "document_date_issue"
                ]
              }
            }
          }
        },
        "responses": { "201": { "description": "Legal document created" } }
      }
    },
    "/legal-docs/upload": {
      "post": {
        "summary": "[ADMIN] Upload PDF, extract and save clauses",
        "description": "Chỉ admin mới được sử dụng. Upload file PDF luật, hệ thống tự động nhận diện dạng text hoặc scan (ảnh). Nếu là scan, sẽ tự động nhận diện tiếng Việt bằng OCR và trích xuất điều khoản.",
        "tags": ["LegalDocument"],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": { "type": "string", "format": "binary" }
                },
                "required": ["file"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Upload và trích xuất thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "count": { "type": "integer" },
                    "document": {
                      "type": "object",
                      "properties": {
                        "id": { "type": "string" },
                        "name": { "type": "string" },
                        "type": { "type": "string" },
                        "date": { "type": "string", "format": "date-time" }
                      }
                    },
                    "clauses": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "string" },
                          "number": { "type": "string" },
                          "title": { "type": "string" },
                          "content": { "type": "string" }
                        }
                      }
                    },
                    "markdown": { "type": "string" },
                    "json": { "type": "string" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "No file uploaded hoặc không trích xuất được điều khoản"
          },
          "500": {
            "description": "Lỗi xử lý file hoặc trích xuất (bao gồm cả lỗi OCR)",
            "content": {
              "application/json": {
                "examples": {
                  "ocrError": {
                    "summary": "Lỗi OCR hoặc chuyển PDF sang ảnh",
                    "value": {
                      "success": false,
                      "error": "Không lấy được buffer ảnh từ pdf2pic. Kiểm tra lại phiên bản pdf2pic hoặc option truyền vào."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },

    "/legal-docs/{id}": {
      "get": {
        "summary": "[USER/ADMIN] Get legal document by ID",
        "description": "User và admin đều có thể xem chi tiết văn bản.",
        "tags": ["LegalDocument"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Legal document found" },
          "404": { "description": "Not found" }
        }
      },
      "put": {
        "summary": "[ADMIN] Update legal document by ID",
        "description": "Chỉ admin mới được cập nhật văn bản.",
        "tags": ["LegalDocument"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "document_name": { "type": "string" },
                  "document_type": { "type": "string" },
                  "document_date_issue": { "type": "string", "format": "date" },
                  "document_signee": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Legal document updated" },
          "404": { "description": "Not found" }
        }
      },
      "delete": {
        "summary": "[ADMIN] Delete legal document by ID",
        "description": "Chỉ admin mới được xóa văn bản.",
        "tags": ["LegalDocument"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Legal document deleted" },
          "404": { "description": "Not found" }
        }
      }
    },

    "/legal-clauses": {
      "get": {
        "summary": "[USER/ADMIN] Get all legal clauses",
        "description": "User và admin đều có thể xem danh sách điều khoản.",
        "tags": ["LegalClause"],
        "responses": { "200": { "description": "List of legal clauses" } }
      },
      "post": {
        "summary": "[ADMIN] Create a new legal clause",
        "description": "Chỉ admin mới được tạo mới điều khoản.",
        "tags": ["LegalClause"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "clause_number": { "type": "string" },
                  "clause_content": { "type": "string" },
                  "embedding": {
                    "type": "array",
                    "items": { "type": "number" }
                  },
                  "document_id": { "type": "string" }
                },
                "required": ["clause_number", "clause_content", "document_id"]
              }
            }
          }
        },
        "responses": { "201": { "description": "Legal clause created" } }
      }
    },
    "/legal-clauses/search": {
      "get": {
        "summary": "[USER/ADMIN] Search legal clauses by keyword",
        "description": "User và admin đều có thể tìm kiếm điều khoản theo từ khóa.",
        "tags": ["LegalClause"],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "Từ khóa tìm kiếm trong nội dung hoặc số điều khoản",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Danh sách điều khoản phù hợp",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "_id": { "type": "string" },
                      "clause_number": { "type": "string" },
                      "clause_content": { "type": "string" },
                      "document_id": { "type": "string" }
                    }
                  }
                }
              }
            }
          },
          "400": { "description": "Missing search keyword" }
        }
      }
    },
    "/legal-clauses/{id}": {
      "get": {
        "summary": "[USER/ADMIN] Get legal clause by ID",
        "description": "User và admin đều có thể xem chi tiết điều khoản.",
        "tags": ["LegalClause"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Legal clause found" },
          "404": { "description": "Not found" }
        }
      },
      "put": {
        "summary": "[ADMIN] Update legal clause by ID",
        "description": "Chỉ admin mới được cập nhật điều khoản.",
        "tags": ["LegalClause"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "clause_number": { "type": "string" },
                  "clause_content": { "type": "string" },
                  "embedding": {
                    "type": "array",
                    "items": { "type": "number" }
                  },
                  "document_id": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Legal clause updated" },
          "404": { "description": "Not found" }
        }
      },
      "delete": {
        "summary": "[ADMIN] Delete legal clause by ID",
        "description": "Chỉ admin mới được xóa điều khoản.",
        "tags": ["LegalClause"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Legal clause deleted" },
          "404": { "description": "Not found" }
        }
      }
    },

    "/notifications": {
      "get": {
        "summary": "[USER/ADMIN] Get all notifications",
        "description": "User và admin đều có thể xem danh sách thông báo.",
        "tags": ["Notification"],
        "responses": { "200": { "description": "List of notifications" } }
      },
      "post": {
        "summary": "[ADMIN] Create a new notification",
        "description": "Chỉ admin mới được tạo mới thông báo.",
        "tags": ["Notification"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": { "type": "string" },
                  "content": { "type": "string" },
                  "isRead": { "type": "boolean" }
                },
                "required": ["title", "content"]
              }
            }
          }
        },
        "responses": { "201": { "description": "Notification created" } }
      }
    },
    "/notifications/{id}": {
      "get": {
        "summary": "[USER/ADMIN] Get notification by ID",
        "description": "User và admin đều có thể xem chi tiết thông báo.",
        "tags": ["Notification"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Notification found" },
          "404": { "description": "Not found" }
        }
      },
      "put": {
        "summary": "[ADMIN] Update notification by ID",
        "description": "Chỉ admin mới được cập nhật thông báo.",
        "tags": ["Notification"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": { "type": "string" },
                  "content": { "type": "string" },
                  "isRead": { "type": "boolean" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Notification updated" },
          "404": { "description": "Not found" }
        }
      },
      "delete": {
        "summary": "[ADMIN] Delete notification by ID",
        "description": "Chỉ admin mới được xóa thông báo.",
        "tags": ["Notification"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Notification deleted" },
          "404": { "description": "Not found" }
        }
      }
    },

    "/questions": {
      "get": {
        "summary": "[ADMIN] Get all questions",
        "tags": ["Question"],
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "List of questions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Question" }
                }
              }
            }
          },
          "401": { "description": "Unauthorized" },
          "403": { "description": "Forbidden" }
        }
      },
      "post": {
        "summary": "Tạo question mới",
        "tags": ["Question"],
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "question_content": { "type": "string" },
                  "account_id": { "type": "string" },
                  "chat_id": { "type": "string" }
                },
                "required": ["question_content", "account_id"]
              },
              "example": {
                "question_content": "Luật giáo dục là gì?",
                "account_id": "user_id",
                "chat_id": "chat_id_phong"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Question created",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Question" }
              }
            }
          },
          "400": { "description": "Invalid input" }
        }
      }
    },
    "/questions/{id}": {
      "get": {
        "summary": "Lấy chi tiết question theo id",
        "tags": ["Question"],
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Question detail",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Question" }
              }
            }
          },
          "404": { "description": "Not found" }
        }
      }
    },
    "/answer/Answer": {
      "get": {
        "summary": "Lấy danh sách answer theo questionId và userId",
        "tags": ["Answer"],
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "questionId",
            "in": "query",
            "schema": { "type": "string" }
          },
          {
            "name": "userId",
            "in": "query",
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "List of answers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Answer" }
                }
              }
            }
          }
        }
      }
    },

    "/feedbacks": {
      "post": {
        "summary": "[USER] Gửi feedback về hệ thống",
        "description": "User gửi góp ý/phản hồi về hệ thống.",
        "tags": ["Feedback"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": { "type": "string" },
                  "content": { "type": "string" }
                },
                "required": ["user_id", "content"]
              }
            }
          }
        },
        "responses": { "201": { "description": "Feedback created" } }
      },
      "get": {
        "summary": "[ADMIN] Xem tất cả feedback",
        "description": "Admin xem danh sách góp ý/phản hồi của user.",
        "tags": ["Feedback"],
        "responses": { "200": { "description": "List of feedbacks" } }
      }
    },
    "/feedbacks/{id}": {
      "put": {
        "summary": "[ADMIN] Xử lý feedback",
        "description": "Admin cập nhật trạng thái hoặc nội dung feedback.",
        "tags": ["Feedback"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "content": { "type": "string" },
                  "status": { "type": "string", "enum": ["pending", "handled"] }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Feedback updated" },
          "404": { "description": "Not found" }
        }
      },
      "delete": {
        "summary": "[ADMIN] Xóa feedback",
        "description": "Admin xóa góp ý/phản hồi.",
        "tags": ["Feedback"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Feedback deleted" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/auth/users": {
      "get": {
        "summary": "[ADMIN] Lấy danh sách tất cả user",
        "description": "Chỉ admin mới được xem danh sách user.",
        "tags": ["User"],
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Danh sách user",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/User" }
                }
              }
            }
          },
          "401": { "description": "Unauthorized" },
          "403": { "description": "Forbidden" }
        }
      }
    },
    "/auth/users/{id}": {
      "get": {
        "summary": "[ADMIN] Lấy user theo ID",
        "description": "Chỉ admin mới được xem thông tin user.",
        "tags": ["User"],
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "User found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "401": { "description": "Unauthorized" },
          "403": { "description": "Forbidden" },
          "404": { "description": "User not found" }
        }
      },
      "put": {
        "summary": "[ADMIN] Cập nhật user theo ID",
        "description": "Chỉ admin mới được cập nhật thông tin user.",
        "tags": ["User"],
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/User" },
              "example": {
                "name": "Nguyen Van B",
                "email": "vanb@example.com",
                "role": "user"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "401": { "description": "Unauthorized" },
          "403": { "description": "Forbidden" },
          "404": { "description": "User not found" }
        }
      },
      "delete": {
        "summary": "[ADMIN] Xóa user theo ID",
        "description": "Chỉ admin mới được xóa user.",
        "tags": ["User"],
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "User deleted" },
          "401": { "description": "Unauthorized" },
          "403": { "description": "Forbidden" },
          "404": { "description": "User not found" }
        }
      }
    },
    "/profile/me": {
      "get": {
        "summary": "Lấy thông tin user hiện tại",
        "tags": ["Profile"],
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Current user info returned",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" }
              }
            }
          },
          "401": { "description": "Unauthorized" }
        }
      },
      "post": {
        "summary": "Cập nhật profile cá nhân (user hoặc admin)",
        "tags": ["Profile"],
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "email": { "type": "string", "format": "email" }
                }
              },
              "example": {
                "name": "Nguyen Van A",
                "email": "vana@example.com"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string" },
                    "user": { "$ref": "#/components/schemas/User" }
                  }
                }
              }
            }
          },
          "401": { "description": "Unauthorized" },
          "404": { "description": "User not found" },
          "500": { "description": "Failed to update profile" }
        }
      },
      "put": {
        "summary": "Cập nhật profile cá nhân (user hoặc admin)",
        "tags": ["Profile"],
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "email": { "type": "string", "format": "email" },
                  "avatar": {
                    "type": "string",
                    "format": "binary",
                    "description": "Ảnh đại diện (jpg, png)"
                  }
                }
              },
              "encoding": {
                "avatar": { "contentType": "image/png, image/jpeg" }
              },
              "example": {
                "name": "Nguyen Van A",
                "email": "vana@example.com",
                "avatar": "<file>"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": { "type": "string" },
                    "user": { "$ref": "#/components/schemas/User" },
                    "needVerifyEmail": { "type": "boolean" }
                  }
                }
              }
            }
          },
          "401": { "description": "Unauthorized" },
          "404": { "description": "User not found" },
          "500": { "description": "Failed to update profile" }
        }
      }
    },
    "/chat-room/create": {
      "post": {
        "summary": "Tạo phòng chat mới",
        "description": "Tạo phòng chat mới cho user với chat_id tự động sinh.",
        "tags": ["ChatRoom"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "account_id": {
                    "type": "string",
                    "description": "ID của user tạo phòng chat"
                  },
                  "room_name": {
                    "type": "string",
                    "description": "Tên phòng chat (optional)"
                  }
                },
                "required": ["account_id"]
              },
              "example": {
                "account_id": "user_id",
                "room_name": "Chủ đề Luật Lao Động"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Phòng chat được tạo thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "chat_id": { "type": "string" },
                    "room": { "$ref": "#/components/schemas/ChatRoom" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dữ liệu đầu vào không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/chat-room/list": {
      "get": {
        "summary": "Lấy danh sách phòng chat của user",
        "description": "Lấy tất cả phòng chat của một user theo account_id.",
        "tags": ["ChatRoom"],
        "parameters": [
          {
            "name": "account_id",
            "in": "query",
            "required": true,
            "description": "ID của user để lấy danh sách phòng chat",
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Danh sách phòng chat",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/ChatRoom" }
                }
              }
            }
          },
          "400": {
            "description": "Thiếu account_id",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/chat-room/message/send": {
      "post": {
        "summary": "Gửi tin nhắn vào phòng chat (tự động sinh answer với AI)",
        "description": "Gửi câu hỏi, hệ thống sẽ tìm kiếm điều khoản liên quan và tạo câu trả lời bằng AI (Gemini).",
        "tags": ["ChatRoom"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "question_content": {
                    "type": "string",
                    "description": "Nội dung câu hỏi về pháp luật"
                  },
                  "account_id": {
                    "type": "string",
                    "description": "ID của user gửi câu hỏi"
                  },
                  "chat_id": {
                    "type": "string",
                    "description": "ID phòng chat (optional, sẽ tự tạo nếu không có)"
                  }
                },
                "required": ["question_content", "account_id"]
              },
              "example": {
                "question_content": "Quy định về nghỉ thai sản theo luật lao động?",
                "account_id": "user_id",
                "chat_id": "chat_id_phong"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Tin nhắn và câu trả lời được tạo thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "object",
                      "properties": {
                        "question": {
                          "type": "object",
                          "properties": {
                            "id": { "type": "string" },
                            "content": { "type": "string" },
                            "date": { "type": "string", "format": "date-time" }
                          }
                        },
                        "answer": {
                          "type": "object",
                          "properties": {
                            "id": { "type": "string" },
                            "ai_response": {
                              "type": "string",
                              "description": "Câu trả lời ngắn gọn của AI"
                            },
                            "full_content": {
                              "type": "string",
                              "description": "Câu trả lời đầy đủ bao gồm cả điều khoản"
                            },
                            "date": { "type": "string", "format": "date-time" }
                          }
                        },
                        "related_clauses": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "stt": { "type": "integer" },
                              "dieu": { "type": "string" },
                              "noi_dung": { "type": "string" },
                              "van_ban": { "type": "string" },
                              "document_id": { "type": "string" }
                            }
                          }
                        },
                        "chat_id": { "type": "string" },
                        "metadata": {
                          "type": "object",
                          "properties": {
                            "keyword_used": { "type": "string" },
                            "search_terms": {
                              "type": "array",
                              "items": { "type": "string" }
                            },
                            "clauses_found": { "type": "integer" },
                            "documents_involved": {
                              "type": "array",
                              "items": { "type": "string" }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dữ liệu đầu vào không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "error": { "type": "string" },
                    "details": { "type": "string" }
                  }
                }
              }
            }
          },
          "409": {
            "description": "Duplicate entry",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "error": { "type": "string" }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Lỗi server",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "error": { "type": "string" },
                    "message": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/chat-room/{chat_id}/messages": {
      "get": {
        "summary": "Lấy lịch sử chat của phòng",
        "description": "Lấy tất cả tin nhắn (question-answer pairs) trong một phòng chat.",
        "tags": ["ChatRoom"],
        "parameters": [
          {
            "name": "chat_id",
            "in": "path",
            "required": true,
            "description": "ID của phòng chat",
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Lịch sử chat của phòng",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/ChatMessage" }
                }
              }
            }
          },
          "500": {
            "description": "Lỗi server",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Nhập JWT token vào đây. Ví dụ: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "name": { "type": "string" },
          "email": { "type": "string" },
          "role": { "type": "string" },
          "isEmailVerified": { "type": "boolean" },
          "createdAt": { "type": "string", "format": "date-time" }
        }
      },
      "Question": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "question_id": { "type": "string" },
          "question_content": { "type": "string" },
          "question_date": { "type": "string", "format": "date-time" },
          "account_id": { "type": "string" },
          "chat_id": { "type": "string" }
        }
      },
      "Answer": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "answer_id": { "type": "string" },
          "answer_content": { "type": "string" },
          "answer_date": { "type": "string", "format": "date-time" },
          "question_id": { "type": "string" },
          "chat_id": { "type": "string" }
        }
      },
      "LegalDocument": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "document_id": { "type": "string" },
          "document_name": { "type": "string" },
          "document_type": { "type": "string" },
          "document_date_issue": { "type": "string", "format": "date" },
          "document_signee": { "type": "string" }
        }
      },
      "LegalClause": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "clause_id": { "type": "string" },
          "clause_number": { "type": "string" },
          "clause_content": { "type": "string" },
          "embedding": { "type": "array", "items": { "type": "number" } },
          "document_id": { "type": "string" }
        }
      },
      "Notification": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "title": { "type": "string" },
          "content": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" },
          "isRead": { "type": "boolean" }
        }
      },
      "Feedback": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "user_id": { "type": "string" },
          "content": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" },
          "status": { "type": "string" }
        }
      },
      "AnswerClause": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "answer_id": { "type": "string" },
          "clause_id": { "type": "string" }
        }
      },
      "ChatRoom": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "chat_id": { "type": "string" },
          "account_id": { "type": "string" },
          "room_name": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" },
          "updatedAt": { "type": "string", "format": "date-time" }
        }
      },
      "ChatMessage": {
        "type": "object",
        "properties": {
          "question": { "type": "string" },
          "answer": { "type": "string" },
          "question_date": { "type": "string", "format": "date-time" },
          "answer_date": { "type": "string", "format": "date-time" },
          "chat_id": { "type": "string" }
        }
      },
      "ChatResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "question": {
                "type": "object",
                "properties": {
                  "id": { "type": "string" },
                  "content": { "type": "string" },
                  "date": { "type": "string", "format": "date-time" }
                }
              },
              "answer": {
                "type": "object",
                "properties": {
                  "id": { "type": "string" },
                  "ai_response": { "type": "string" },
                  "full_content": { "type": "string" },
                  "date": { "type": "string", "format": "date-time" }
                }
              },
              "related_clauses": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "stt": { "type": "integer" },
                    "dieu": { "type": "string" },
                    "noi_dung": { "type": "string" },
                    "van_ban": { "type": "string" },
                    "document_id": { "type": "string" }
                  }
                }
              },
              "chat_id": { "type": "string" },
              "metadata": {
                "type": "object",
                "properties": {
                  "keyword_used": { "type": "string" },
                  "search_terms": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "clauses_found": { "type": "integer" },
                  "documents_involved": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
